{"ast":null,"code":"import axios from 'axios';\n\n// DMI API Configuration\nconst DMI_CONFIG = {\n  DEALER_ID: '118215',\n  REST_CODE: 'DL67AJ19M2R0J',\n  BASE_URL: 'https://dmidrs.com/dealers/dmirest',\n  SANDBOX_URL: 'https://dmidrs.com/dealers_sb/dmirest',\n  USE_SANDBOX: true,\n  // Changed to true to test sandbox\n  USE_MOCK: false // Set to true to use mock data\n};\n\n// Enhanced cache system\nlet inventoryCache = null;\nlet cacheTimestamp = null;\nconst CACHE_DURATION = 30 * 60 * 1000; // 30 minutes (increased from 5)\n\n// Search cache to store recent search results\nconst searchCache = new Map();\nconst SEARCH_CACHE_DURATION = 10 * 60 * 1000; // 10 minutes\nconst MAX_SEARCH_CACHE_SIZE = 100;\n\n// Loading state\nlet isLoadingInventory = false;\nlet loadingPromise = null;\n\n// Pre-indexed search data for faster lookups\nlet searchIndex = null;\nlet indexTimestamp = null;\n\n// Create axios instance with default config\nconst apiClient = axios.create({\n  timeout: 60000,\n  // Increased to 60 seconds\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\n\n// Request interceptor for debugging\napiClient.interceptors.request.use(request => {\n  console.log('DMI API Request:', request);\n  return request;\n}, error => {\n  console.error('DMI API Request Error:', error);\n  return Promise.reject(error);\n});\n\n// Response interceptor for debugging\napiClient.interceptors.response.use(response => {\n  console.log('DMI API Response:', response);\n  return response;\n}, error => {\n  console.error('DMI API Response Error:', error);\n  return Promise.reject(error);\n});\n\n// Helper function to build URL with credentials\nconst buildUrl = (resource, additionalParams = {}) => {\n  const params = new URLSearchParams({\n    format: 'json',\n    resource: resource,\n    dealerid: DMI_CONFIG.DEALER_ID,\n    restcode: DMI_CONFIG.REST_CODE,\n    ...additionalParams\n  });\n\n  // In development, use relative URL to work with proxy\n  if (process.env.NODE_ENV === 'development') {\n    const path = DMI_CONFIG.USE_SANDBOX ? '/dealers_sb/dmirest' : '/dealers/dmirest';\n    return `${path}/dmirest.php?${params.toString()}`;\n  }\n\n  // In production, use full URL\n  const baseUrl = DMI_CONFIG.USE_SANDBOX ? DMI_CONFIG.SANDBOX_URL : DMI_CONFIG.BASE_URL;\n  return `${baseUrl}/dmirest.php?${params.toString()}`;\n};\n\n// Helper function to build POST URL\nconst buildPostUrl = resource => {\n  const params = new URLSearchParams({\n    format: 'json',\n    resource: resource,\n    dealerid: DMI_CONFIG.DEALER_ID,\n    restcode: DMI_CONFIG.REST_CODE\n  });\n\n  // In development, use relative URL to work with proxy\n  if (process.env.NODE_ENV === 'development') {\n    const path = DMI_CONFIG.USE_SANDBOX ? '/dealers_sb/dmirest' : '/dealers/dmirest';\n    return `${path}/dmirest/dmirest_api.php?${params.toString()}`;\n  }\n\n  // In production, use full URL\n  const baseUrl = DMI_CONFIG.USE_SANDBOX ? DMI_CONFIG.SANDBOX_URL : DMI_CONFIG.BASE_URL;\n  return `${baseUrl}/dmirest/dmirest_api.php?${params.toString()}`;\n};\n\n// Helper function to create search index\nconst createSearchIndex = inventory => {\n  const index = {\n    byModel: new Map(),\n    byBrand: new Map(),\n    byDescription: new Map(),\n    byCategory: new Map(),\n    allItems: inventory\n  };\n  inventory.forEach(item => {\n    // Index by model number\n    if (item.Model_Number) {\n      const modelLower = item.Model_Number.toLowerCase();\n      // Store by full model and by parts\n      index.byModel.set(modelLower, item);\n\n      // Also index by model parts for partial matches\n      const modelParts = modelLower.split(/[\\s-_]+/);\n      modelParts.forEach(part => {\n        if (part.length > 2) {\n          if (!index.byModel.has(part)) {\n            index.byModel.set(part, []);\n          }\n          const items = index.byModel.get(part);\n          if (Array.isArray(items)) {\n            items.push(item);\n          }\n        }\n      });\n    }\n\n    // Index by brand\n    if (item.Brand) {\n      const brandLower = item.Brand.toLowerCase();\n      if (!index.byBrand.has(brandLower)) {\n        index.byBrand.set(brandLower, []);\n      }\n      index.byBrand.get(brandLower).push(item);\n    }\n\n    // Index by description words\n    if (item.Description) {\n      const words = item.Description.toLowerCase().split(/\\s+/);\n      words.forEach(word => {\n        if (word.length > 3) {\n          if (!index.byDescription.has(word)) {\n            index.byDescription.set(word, []);\n          }\n          index.byDescription.get(word).push(item);\n        }\n      });\n    }\n\n    // Index by category\n    if (item.Category_Major) {\n      const categoryLower = item.Category_Major.toLowerCase();\n      if (!index.byCategory.has(categoryLower)) {\n        index.byCategory.set(categoryLower, []);\n      }\n      index.byCategory.get(categoryLower).push(item);\n    }\n  });\n  return index;\n};\n\n// Helper function to search using index\nconst searchWithIndex = (searchTerm, index) => {\n  const searchLower = searchTerm.toLowerCase();\n  const resultSet = new Set();\n\n  // Exact model match has highest priority\n  if (index.byModel.has(searchLower)) {\n    const item = index.byModel.get(searchLower);\n    if (!Array.isArray(item)) {\n      resultSet.add(item);\n    }\n  }\n\n  // Search in model parts\n  const searchParts = searchLower.split(/[\\s-_]+/);\n  searchParts.forEach(part => {\n    if (part.length > 2 && index.byModel.has(part)) {\n      const items = index.byModel.get(part);\n      if (Array.isArray(items)) {\n        items.forEach(item => resultSet.add(item));\n      }\n    }\n  });\n\n  // Search in brands\n  if (index.byBrand.has(searchLower)) {\n    index.byBrand.get(searchLower).forEach(item => resultSet.add(item));\n  }\n\n  // Search in description words\n  const words = searchLower.split(/\\s+/);\n  words.forEach(word => {\n    if (word.length > 3 && index.byDescription.has(word)) {\n      index.byDescription.get(word).forEach(item => resultSet.add(item));\n    }\n  });\n\n  // Search in categories\n  if (index.byCategory.has(searchLower)) {\n    index.byCategory.get(searchLower).forEach(item => resultSet.add(item));\n  }\n\n  // Also do a fallback substring search on items not yet found\n  if (resultSet.size < 50) {\n    index.allItems.forEach(item => {\n      if (!resultSet.has(item)) {\n        const modelMatch = item.Model_Number && item.Model_Number.toLowerCase().includes(searchLower);\n        const descMatch = item.Description && item.Description.toLowerCase().includes(searchLower);\n        const brandMatch = item.Brand && item.Brand.toLowerCase().includes(searchLower);\n        if (modelMatch || descMatch || brandMatch) {\n          resultSet.add(item);\n        }\n      }\n    });\n  }\n  return Array.from(resultSet);\n};\n\n// DMI API Service\nconst dmiApi = {\n  // Preload inventory (call this on app start)\n  async preloadInventory() {\n    if (inventoryCache && cacheTimestamp && Date.now() - cacheTimestamp < CACHE_DURATION) {\n      console.log('üì¶ Inventory already cached');\n      return;\n    }\n    console.log('üîÑ Preloading inventory in background...');\n    // Don't await, let it load in background\n    this.getInventory().catch(err => {\n      console.error('Failed to preload inventory:', err);\n    });\n  },\n  // Get full inventory with improved caching\n  async getInventory(params = {}) {\n    if (DMI_CONFIG.USE_MOCK) {\n      console.log('üîÑ Mock mode is enabled but no mock data available');\n      return [];\n    }\n\n    // Check cache first\n    if (inventoryCache && cacheTimestamp && Date.now() - cacheTimestamp < CACHE_DURATION) {\n      console.log('üì¶ Using cached inventory data');\n      return inventoryCache;\n    }\n\n    // If already loading, return the existing promise\n    if (isLoadingInventory && loadingPromise) {\n      console.log('‚è≥ Inventory is already being loaded, waiting...');\n      return loadingPromise;\n    }\n    isLoadingInventory = true;\n    loadingPromise = (async () => {\n      try {\n        const url = buildUrl('inventory', params);\n        console.log('üåê Fetching real inventory from DMI API...');\n        console.log('API URL:', url);\n        const response = await apiClient.get(url);\n        console.log('üì° API Response status:', response.status);\n        console.log('üì° API Response data type:', typeof response.data);\n        console.log('üì° API Response is array:', Array.isArray(response.data));\n\n        // Check if response.data is actually the inventory array\n        let inventoryData = response.data;\n\n        // Sometimes APIs wrap data in an object\n        if (response.data && !Array.isArray(response.data)) {\n          console.log('‚ö†Ô∏è Response data is not an array, checking for wrapped data...');\n          console.log('Response keys:', Object.keys(response.data));\n\n          // Check common wrapper patterns\n          if (response.data.data && Array.isArray(response.data.data)) {\n            inventoryData = response.data.data;\n          } else if (response.data.items && Array.isArray(response.data.items)) {\n            inventoryData = response.data.items;\n          } else if (response.data.inventory && Array.isArray(response.data.inventory)) {\n            inventoryData = response.data.inventory;\n          } else {\n            console.error('‚ùå Unexpected response format:', response.data);\n            return [];\n          }\n        }\n\n        // Cache the response\n        inventoryCache = inventoryData;\n        cacheTimestamp = Date.now();\n\n        // Create search index\n        console.log('üîç Creating search index...');\n        searchIndex = createSearchIndex(inventoryData);\n        indexTimestamp = Date.now();\n        console.log(`‚úÖ Received ${inventoryData.length} items from DMI API`);\n        console.log('Sample items:', inventoryData.slice(0, 3));\n        return inventoryData;\n      } catch (error) {\n        console.error('‚ùå Error fetching inventory:', error);\n\n        // More detailed error logging\n        if (error.code === 'ECONNABORTED') {\n          console.error('‚è±Ô∏è Request timed out. The API might be slow or credentials might be incorrect.');\n          console.error('URL attempted:', url);\n        }\n        if (error.response) {\n          console.error('üì° Error response:', error.response.status, error.response.statusText);\n          console.error('üì° Error data:', error.response.data);\n        }\n\n        // Return empty array if API fails\n        console.log('‚ö†Ô∏è API error, returning empty array');\n        return [];\n      } finally {\n        isLoadingInventory = false;\n        loadingPromise = null;\n      }\n    })();\n    return loadingPromise;\n  },\n  // Get inventory changes since timestamp\n  async getInventoryChanges(lastUpdate) {\n    if (DMI_CONFIG.USE_MOCK) {\n      return [];\n    }\n    try {\n      const url = buildUrl('inventorychanges', {\n        lastupdate: lastUpdate\n      });\n      const response = await apiClient.get(url);\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching inventory changes:', error);\n      throw error;\n    }\n  },\n  // Optimized search with caching and indexing\n  async searchInventoryByModel(searchTerm) {\n    if (!searchTerm || searchTerm.length < 2) {\n      console.log('‚ùå Search term too short:', searchTerm);\n      return [];\n    }\n    console.log('üîç Starting search for:', searchTerm);\n\n    // Check search cache first\n    const cacheKey = searchTerm.toLowerCase();\n    const cachedResult = searchCache.get(cacheKey);\n    if (cachedResult && Date.now() - cachedResult.timestamp < SEARCH_CACHE_DURATION) {\n      console.log('üéØ Using cached search results for:', searchTerm);\n      return cachedResult.results;\n    }\n    try {\n      // Check if we have inventory data at all\n      if (!inventoryCache && !searchIndex) {\n        console.log('‚ö†Ô∏è No inventory data available, fetching...');\n        await this.getInventory();\n      }\n\n      // Use indexed search if available and fresh\n      if (searchIndex && indexTimestamp && Date.now() - indexTimestamp < CACHE_DURATION) {\n        console.log('‚ö° Using indexed search for:', searchTerm);\n        console.log('üìä Search index stats:', {\n          modelEntries: searchIndex.byModel.size,\n          brandEntries: searchIndex.byBrand.size,\n          totalItems: searchIndex.allItems.length\n        });\n        const results = searchWithIndex(searchTerm, searchIndex);\n        console.log(`üì¶ Index search found ${results.length} results`);\n\n        // Sort results to prioritize exact matches\n        const searchLower = searchTerm.toLowerCase();\n        const sorted = results.sort((a, b) => {\n          const aModelExact = a.Model_Number && a.Model_Number.toLowerCase() === searchLower;\n          const bModelExact = b.Model_Number && b.Model_Number.toLowerCase() === searchLower;\n          if (aModelExact && !bModelExact) return -1;\n          if (!aModelExact && bModelExact) return 1;\n          const aModelStarts = a.Model_Number && a.Model_Number.toLowerCase().startsWith(searchLower);\n          const bModelStarts = b.Model_Number && b.Model_Number.toLowerCase().startsWith(searchLower);\n          if (aModelStarts && !bModelStarts) return -1;\n          if (!aModelStarts && bModelStarts) return 1;\n          return 0;\n        });\n        const limitedResults = sorted.slice(0, 50);\n\n        // Cache the search results\n        searchCache.set(cacheKey, {\n          results: limitedResults,\n          timestamp: Date.now()\n        });\n\n        // Clean up old cache entries if too many\n        if (searchCache.size > MAX_SEARCH_CACHE_SIZE) {\n          const oldestKey = searchCache.keys().next().value;\n          searchCache.delete(oldestKey);\n        }\n        return limitedResults;\n      }\n\n      // Fallback to regular search if index not available\n      console.log('üîç Using regular search (no index) for:', searchTerm);\n      const inventory = await this.getInventory();\n      console.log(`üìä Inventory has ${inventory.length} items`);\n      if (inventory.length === 0) {\n        console.log('‚ùå No inventory data available');\n        return [];\n      }\n      const searchLower = searchTerm.toLowerCase();\n\n      // Filter results based on model number, description, or brand\n      const filtered = inventory.filter(item => {\n        const modelMatch = item.Model_Number && item.Model_Number.toLowerCase().includes(searchLower);\n        const descMatch = item.Description && item.Description.toLowerCase().includes(searchLower);\n        const brandMatch = item.Brand && item.Brand.toLowerCase().includes(searchLower);\n        const categoryMatch = item.Category_Major && item.Category_Major.toLowerCase().includes(searchLower);\n        return modelMatch || descMatch || brandMatch || categoryMatch;\n      });\n      console.log(`üì¶ Regular search found ${filtered.length} results`);\n\n      // Sort results to prioritize exact matches and model number matches\n      const sorted = filtered.sort((a, b) => {\n        const aModelExact = a.Model_Number && a.Model_Number.toLowerCase() === searchLower;\n        const bModelExact = b.Model_Number && b.Model_Number.toLowerCase() === searchLower;\n        if (aModelExact && !bModelExact) return -1;\n        if (!aModelExact && bModelExact) return 1;\n        const aModelStarts = a.Model_Number && a.Model_Number.toLowerCase().startsWith(searchLower);\n        const bModelStarts = b.Model_Number && b.Model_Number.toLowerCase().startsWith(searchLower);\n        if (aModelStarts && !bModelStarts) return -1;\n        if (!aModelStarts && bModelStarts) return 1;\n        return 0;\n      });\n\n      // Limit results for performance\n      const limitedResults = sorted.slice(0, 50);\n\n      // Cache the results\n      searchCache.set(cacheKey, {\n        results: limitedResults,\n        timestamp: Date.now()\n      });\n      return limitedResults;\n    } catch (error) {\n      console.error('Error searching inventory:', error);\n      // Return empty array on error\n      return [];\n    }\n  },\n  // Get inventory by brand\n  async getInventoryByBrand(brandCode) {\n    if (DMI_CONFIG.USE_MOCK) {\n      return [];\n    }\n    try {\n      const url = buildUrl('inventory', {\n        brand: brandCode\n      });\n      const response = await apiClient.get(url);\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching inventory by brand:', error);\n      throw error;\n    }\n  },\n  // Get order status\n  async getOrderStatus(orderCriteria) {\n    if (DMI_CONFIG.USE_MOCK) {\n      return [];\n    }\n    try {\n      const url = buildUrl('orderstatus');\n      const response = await apiClient.post(url, orderCriteria);\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching order status:', error);\n      throw error;\n    }\n  },\n  // Get open orders\n  async getOpenOrders(params = {}) {\n    if (DMI_CONFIG.USE_MOCK) {\n      return [];\n    }\n    try {\n      const url = buildUrl('openorders', params);\n      const response = await apiClient.get(url);\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching open orders:', error);\n      throw error;\n    }\n  },\n  // Get open backorders\n  async getOpenBackorders(params = {}) {\n    if (DMI_CONFIG.USE_MOCK) {\n      return [];\n    }\n    try {\n      const url = buildUrl('openbackorders', params);\n      const response = await apiClient.get(url);\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching open backorders:', error);\n      throw error;\n    }\n  },\n  // Get invoice details\n  async getInvoiceDetail(params = {}) {\n    if (DMI_CONFIG.USE_MOCK) {\n      return [];\n    }\n    try {\n      const url = buildUrl('invoicedetail', params);\n      const response = await apiClient.get(url);\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching invoice detail:', error);\n      throw error;\n    }\n  },\n  // Create new order\n  async createNewOrder(orderData) {\n    if (DMI_CONFIG.USE_MOCK) {\n      return {\n        Result: 'OK',\n        Transaction_ID: 'MOCK_' + Date.now(),\n        DMI_Order_ID: Math.floor(Math.random() * 100000),\n        ...orderData[0].orderheader\n      };\n    }\n    try {\n      const url = buildPostUrl('neworder');\n      const response = await apiClient.post(url, orderData);\n      return response.data;\n    } catch (error) {\n      console.error('Error creating new order:', error);\n      throw error;\n    }\n  },\n  // Add new order line\n  async addNewOrderLine(orderLineData) {\n    if (DMI_CONFIG.USE_MOCK) {\n      return {\n        Result: 'OK',\n        Transaction_ID: 'MOCK_' + Date.now(),\n        ...orderLineData[0]\n      };\n    }\n    try {\n      const url = buildPostUrl('neworderline');\n      const response = await apiClient.post(url, orderLineData);\n      return response.data;\n    } catch (error) {\n      console.error('Error adding new order line:', error);\n      throw error;\n    }\n  },\n  // Change order\n  async changeOrder(changeData) {\n    if (DMI_CONFIG.USE_MOCK) {\n      return {\n        Result: 'OK',\n        Transaction_ID: 'MOCK_' + Date.now(),\n        ...changeData[0]\n      };\n    }\n    try {\n      const url = buildPostUrl('changeorder');\n      const response = await apiClient.post(url, changeData);\n      return response.data;\n    } catch (error) {\n      console.error('Error changing order:', error);\n      throw error;\n    }\n  },\n  // Change order item\n  async changeOrderItem(changeData) {\n    if (DMI_CONFIG.USE_MOCK) {\n      return {\n        Result: 'OK',\n        Transaction_ID: 'MOCK_' + Date.now(),\n        ...changeData[0]\n      };\n    }\n    try {\n      const url = buildPostUrl('changeorderitem');\n      const response = await apiClient.post(url, changeData);\n      return response.data;\n    } catch (error) {\n      console.error('Error changing order item:', error);\n      throw error;\n    }\n  },\n  // Utility function to format price\n  formatPrice(price) {\n    if (!price || price === '0.00') return 'Call for price';\n    return `$${parseFloat(price).toFixed(2)}`;\n  },\n  // Utility function to check availability\n  checkAvailability(item) {\n    const available = parseInt(item.Available) || 0;\n    const hasStock = item.Has_Stock === 'Y';\n    const backordered = parseInt(item.Backordered) || 0;\n    const onOrder = parseInt(item.On_Order) || 0;\n    const inTransit = parseInt(item.In_Transit) || 0;\n    if (hasStock && available > 0) {\n      return {\n        status: 'In Stock',\n        quantity: available,\n        color: 'success'\n      };\n    } else if (available > 0) {\n      return {\n        status: 'Available',\n        quantity: available,\n        color: 'warning'\n      };\n    } else if (inTransit > 0) {\n      return {\n        status: 'In Transit',\n        quantity: inTransit,\n        color: 'info'\n      };\n    } else if (onOrder > 0) {\n      return {\n        status: 'On Order',\n        quantity: onOrder,\n        color: 'info'\n      };\n    } else if (backordered > 0) {\n      return {\n        status: 'Backordered',\n        quantity: backordered,\n        color: 'error'\n      };\n    } else {\n      return {\n        status: 'Out of Stock',\n        quantity: 0,\n        color: 'error'\n      };\n    }\n  },\n  // Clear all caches\n  clearCache() {\n    inventoryCache = null;\n    cacheTimestamp = null;\n    searchCache.clear();\n    searchIndex = null;\n    indexTimestamp = null;\n    console.log('üßπ All caches cleared');\n  },\n  // Get cache status\n  getCacheStatus() {\n    return {\n      inventoryCached: !!inventoryCache,\n      inventoryCacheAge: cacheTimestamp ? Date.now() - cacheTimestamp : null,\n      searchCacheSize: searchCache.size,\n      indexAvailable: !!searchIndex,\n      indexAge: indexTimestamp ? Date.now() - indexTimestamp : null\n    };\n  },\n  // Get config for debugging\n  getConfig() {\n    return DMI_CONFIG;\n  },\n  // Export buildUrl for testing\n  buildUrl,\n  // Test API connectivity\n  async testConnection() {\n    console.log('üß™ Testing API connection...');\n    try {\n      // Try a simple request first\n      const testUrl = '/dealers/dmirest/dmirest.php?format=json&resource=inventory&dealerid=118215&restcode=DL67AJ19M2R0J&limit=1';\n      console.log('Test URL:', testUrl);\n      const response = await apiClient.get(testUrl, {\n        timeout: 10000\n      }); // 10 second timeout for test\n      console.log('‚úÖ API connection successful!');\n      console.log('Response:', response.data);\n      return true;\n    } catch (error) {\n      console.error('‚ùå API connection failed:', error.message);\n      if (error.response) {\n        console.error('Response status:', error.response.status);\n        console.error('Response data:', error.response.data);\n      }\n      return false;\n    }\n  }\n};\nexport default dmiApi;","map":{"version":3,"names":["axios","DMI_CONFIG","DEALER_ID","REST_CODE","BASE_URL","SANDBOX_URL","USE_SANDBOX","USE_MOCK","inventoryCache","cacheTimestamp","CACHE_DURATION","searchCache","Map","SEARCH_CACHE_DURATION","MAX_SEARCH_CACHE_SIZE","isLoadingInventory","loadingPromise","searchIndex","indexTimestamp","apiClient","create","timeout","headers","interceptors","request","use","console","log","error","Promise","reject","response","buildUrl","resource","additionalParams","params","URLSearchParams","format","dealerid","restcode","process","env","NODE_ENV","path","toString","baseUrl","buildPostUrl","createSearchIndex","inventory","index","byModel","byBrand","byDescription","byCategory","allItems","forEach","item","Model_Number","modelLower","toLowerCase","set","modelParts","split","part","length","has","items","get","Array","isArray","push","Brand","brandLower","Description","words","word","Category_Major","categoryLower","searchWithIndex","searchTerm","searchLower","resultSet","Set","add","searchParts","size","modelMatch","includes","descMatch","brandMatch","from","dmiApi","preloadInventory","Date","now","getInventory","catch","err","url","status","data","inventoryData","Object","keys","slice","code","statusText","getInventoryChanges","lastUpdate","lastupdate","searchInventoryByModel","cacheKey","cachedResult","timestamp","results","modelEntries","brandEntries","totalItems","sorted","sort","a","b","aModelExact","bModelExact","aModelStarts","startsWith","bModelStarts","limitedResults","oldestKey","next","value","delete","filtered","filter","categoryMatch","getInventoryByBrand","brandCode","brand","getOrderStatus","orderCriteria","post","getOpenOrders","getOpenBackorders","getInvoiceDetail","createNewOrder","orderData","Result","Transaction_ID","DMI_Order_ID","Math","floor","random","orderheader","addNewOrderLine","orderLineData","changeOrder","changeData","changeOrderItem","formatPrice","price","parseFloat","toFixed","checkAvailability","available","parseInt","Available","hasStock","Has_Stock","backordered","Backordered","onOrder","On_Order","inTransit","In_Transit","quantity","color","clearCache","clear","getCacheStatus","inventoryCached","inventoryCacheAge","searchCacheSize","indexAvailable","indexAge","getConfig","testConnection","testUrl","message"],"sources":["/Users/anuragmishra/Documents/Development/ML_Resources/RA/src/services/dmiApi.js"],"sourcesContent":["import axios from 'axios';\n\n// DMI API Configuration\nconst DMI_CONFIG = {\n    DEALER_ID: '118215',\n    REST_CODE: 'DL67AJ19M2R0J',\n    BASE_URL: 'https://dmidrs.com/dealers/dmirest',\n    SANDBOX_URL: 'https://dmidrs.com/dealers_sb/dmirest',\n    USE_SANDBOX: true, // Changed to true to test sandbox\n    USE_MOCK: false // Set to true to use mock data\n};\n\n// Enhanced cache system\nlet inventoryCache = null;\nlet cacheTimestamp = null;\nconst CACHE_DURATION = 30 * 60 * 1000; // 30 minutes (increased from 5)\n\n// Search cache to store recent search results\nconst searchCache = new Map();\nconst SEARCH_CACHE_DURATION = 10 * 60 * 1000; // 10 minutes\nconst MAX_SEARCH_CACHE_SIZE = 100;\n\n// Loading state\nlet isLoadingInventory = false;\nlet loadingPromise = null;\n\n// Pre-indexed search data for faster lookups\nlet searchIndex = null;\nlet indexTimestamp = null;\n\n// Create axios instance with default config\nconst apiClient = axios.create({\n    timeout: 60000, // Increased to 60 seconds\n    headers: {\n        'Content-Type': 'application/json',\n    }\n});\n\n// Request interceptor for debugging\napiClient.interceptors.request.use(request => {\n    console.log('DMI API Request:', request);\n    return request;\n}, error => {\n    console.error('DMI API Request Error:', error);\n    return Promise.reject(error);\n});\n\n// Response interceptor for debugging\napiClient.interceptors.response.use(response => {\n    console.log('DMI API Response:', response);\n    return response;\n}, error => {\n    console.error('DMI API Response Error:', error);\n    return Promise.reject(error);\n});\n\n// Helper function to build URL with credentials\nconst buildUrl = (resource, additionalParams = {}) => {\n    const params = new URLSearchParams({\n        format: 'json',\n        resource: resource,\n        dealerid: DMI_CONFIG.DEALER_ID,\n        restcode: DMI_CONFIG.REST_CODE,\n        ...additionalParams\n    });\n\n    // In development, use relative URL to work with proxy\n    if (process.env.NODE_ENV === 'development') {\n        const path = DMI_CONFIG.USE_SANDBOX ? '/dealers_sb/dmirest' : '/dealers/dmirest';\n        return `${path}/dmirest.php?${params.toString()}`;\n    }\n\n    // In production, use full URL\n    const baseUrl = DMI_CONFIG.USE_SANDBOX ? DMI_CONFIG.SANDBOX_URL : DMI_CONFIG.BASE_URL;\n    return `${baseUrl}/dmirest.php?${params.toString()}`;\n};\n\n// Helper function to build POST URL\nconst buildPostUrl = (resource) => {\n    const params = new URLSearchParams({\n        format: 'json',\n        resource: resource,\n        dealerid: DMI_CONFIG.DEALER_ID,\n        restcode: DMI_CONFIG.REST_CODE\n    });\n\n    // In development, use relative URL to work with proxy\n    if (process.env.NODE_ENV === 'development') {\n        const path = DMI_CONFIG.USE_SANDBOX ? '/dealers_sb/dmirest' : '/dealers/dmirest';\n        return `${path}/dmirest/dmirest_api.php?${params.toString()}`;\n    }\n\n    // In production, use full URL\n    const baseUrl = DMI_CONFIG.USE_SANDBOX ? DMI_CONFIG.SANDBOX_URL : DMI_CONFIG.BASE_URL;\n    return `${baseUrl}/dmirest/dmirest_api.php?${params.toString()}`;\n};\n\n// Helper function to create search index\nconst createSearchIndex = (inventory) => {\n    const index = {\n        byModel: new Map(),\n        byBrand: new Map(),\n        byDescription: new Map(),\n        byCategory: new Map(),\n        allItems: inventory\n    };\n\n    inventory.forEach(item => {\n        // Index by model number\n        if (item.Model_Number) {\n            const modelLower = item.Model_Number.toLowerCase();\n            // Store by full model and by parts\n            index.byModel.set(modelLower, item);\n\n            // Also index by model parts for partial matches\n            const modelParts = modelLower.split(/[\\s-_]+/);\n            modelParts.forEach(part => {\n                if (part.length > 2) {\n                    if (!index.byModel.has(part)) {\n                        index.byModel.set(part, []);\n                    }\n                    const items = index.byModel.get(part);\n                    if (Array.isArray(items)) {\n                        items.push(item);\n                    }\n                }\n            });\n        }\n\n        // Index by brand\n        if (item.Brand) {\n            const brandLower = item.Brand.toLowerCase();\n            if (!index.byBrand.has(brandLower)) {\n                index.byBrand.set(brandLower, []);\n            }\n            index.byBrand.get(brandLower).push(item);\n        }\n\n        // Index by description words\n        if (item.Description) {\n            const words = item.Description.toLowerCase().split(/\\s+/);\n            words.forEach(word => {\n                if (word.length > 3) {\n                    if (!index.byDescription.has(word)) {\n                        index.byDescription.set(word, []);\n                    }\n                    index.byDescription.get(word).push(item);\n                }\n            });\n        }\n\n        // Index by category\n        if (item.Category_Major) {\n            const categoryLower = item.Category_Major.toLowerCase();\n            if (!index.byCategory.has(categoryLower)) {\n                index.byCategory.set(categoryLower, []);\n            }\n            index.byCategory.get(categoryLower).push(item);\n        }\n    });\n\n    return index;\n};\n\n// Helper function to search using index\nconst searchWithIndex = (searchTerm, index) => {\n    const searchLower = searchTerm.toLowerCase();\n    const resultSet = new Set();\n\n    // Exact model match has highest priority\n    if (index.byModel.has(searchLower)) {\n        const item = index.byModel.get(searchLower);\n        if (!Array.isArray(item)) {\n            resultSet.add(item);\n        }\n    }\n\n    // Search in model parts\n    const searchParts = searchLower.split(/[\\s-_]+/);\n    searchParts.forEach(part => {\n        if (part.length > 2 && index.byModel.has(part)) {\n            const items = index.byModel.get(part);\n            if (Array.isArray(items)) {\n                items.forEach(item => resultSet.add(item));\n            }\n        }\n    });\n\n    // Search in brands\n    if (index.byBrand.has(searchLower)) {\n        index.byBrand.get(searchLower).forEach(item => resultSet.add(item));\n    }\n\n    // Search in description words\n    const words = searchLower.split(/\\s+/);\n    words.forEach(word => {\n        if (word.length > 3 && index.byDescription.has(word)) {\n            index.byDescription.get(word).forEach(item => resultSet.add(item));\n        }\n    });\n\n    // Search in categories\n    if (index.byCategory.has(searchLower)) {\n        index.byCategory.get(searchLower).forEach(item => resultSet.add(item));\n    }\n\n    // Also do a fallback substring search on items not yet found\n    if (resultSet.size < 50) {\n        index.allItems.forEach(item => {\n            if (!resultSet.has(item)) {\n                const modelMatch = item.Model_Number && item.Model_Number.toLowerCase().includes(searchLower);\n                const descMatch = item.Description && item.Description.toLowerCase().includes(searchLower);\n                const brandMatch = item.Brand && item.Brand.toLowerCase().includes(searchLower);\n\n                if (modelMatch || descMatch || brandMatch) {\n                    resultSet.add(item);\n                }\n            }\n        });\n    }\n\n    return Array.from(resultSet);\n};\n\n// DMI API Service\nconst dmiApi = {\n    // Preload inventory (call this on app start)\n    async preloadInventory() {\n        if (inventoryCache && cacheTimestamp && (Date.now() - cacheTimestamp < CACHE_DURATION)) {\n            console.log('üì¶ Inventory already cached');\n            return;\n        }\n\n        console.log('üîÑ Preloading inventory in background...');\n        // Don't await, let it load in background\n        this.getInventory().catch(err => {\n            console.error('Failed to preload inventory:', err);\n        });\n    },\n\n    // Get full inventory with improved caching\n    async getInventory(params = {}) {\n        if (DMI_CONFIG.USE_MOCK) {\n            console.log('üîÑ Mock mode is enabled but no mock data available');\n            return [];\n        }\n\n        // Check cache first\n        if (inventoryCache && cacheTimestamp && (Date.now() - cacheTimestamp < CACHE_DURATION)) {\n            console.log('üì¶ Using cached inventory data');\n            return inventoryCache;\n        }\n\n        // If already loading, return the existing promise\n        if (isLoadingInventory && loadingPromise) {\n            console.log('‚è≥ Inventory is already being loaded, waiting...');\n            return loadingPromise;\n        }\n\n        isLoadingInventory = true;\n\n        loadingPromise = (async () => {\n            try {\n                const url = buildUrl('inventory', params);\n                console.log('üåê Fetching real inventory from DMI API...');\n                console.log('API URL:', url);\n\n                const response = await apiClient.get(url);\n\n                console.log('üì° API Response status:', response.status);\n                console.log('üì° API Response data type:', typeof response.data);\n                console.log('üì° API Response is array:', Array.isArray(response.data));\n\n                // Check if response.data is actually the inventory array\n                let inventoryData = response.data;\n\n                // Sometimes APIs wrap data in an object\n                if (response.data && !Array.isArray(response.data)) {\n                    console.log('‚ö†Ô∏è Response data is not an array, checking for wrapped data...');\n                    console.log('Response keys:', Object.keys(response.data));\n\n                    // Check common wrapper patterns\n                    if (response.data.data && Array.isArray(response.data.data)) {\n                        inventoryData = response.data.data;\n                    } else if (response.data.items && Array.isArray(response.data.items)) {\n                        inventoryData = response.data.items;\n                    } else if (response.data.inventory && Array.isArray(response.data.inventory)) {\n                        inventoryData = response.data.inventory;\n                    } else {\n                        console.error('‚ùå Unexpected response format:', response.data);\n                        return [];\n                    }\n                }\n\n                // Cache the response\n                inventoryCache = inventoryData;\n                cacheTimestamp = Date.now();\n\n                // Create search index\n                console.log('üîç Creating search index...');\n                searchIndex = createSearchIndex(inventoryData);\n                indexTimestamp = Date.now();\n\n                console.log(`‚úÖ Received ${inventoryData.length} items from DMI API`);\n                console.log('Sample items:', inventoryData.slice(0, 3));\n\n                return inventoryData;\n            } catch (error) {\n                console.error('‚ùå Error fetching inventory:', error);\n\n                // More detailed error logging\n                if (error.code === 'ECONNABORTED') {\n                    console.error('‚è±Ô∏è Request timed out. The API might be slow or credentials might be incorrect.');\n                    console.error('URL attempted:', url);\n                }\n\n                if (error.response) {\n                    console.error('üì° Error response:', error.response.status, error.response.statusText);\n                    console.error('üì° Error data:', error.response.data);\n                }\n\n                // Return empty array if API fails\n                console.log('‚ö†Ô∏è API error, returning empty array');\n                return [];\n            } finally {\n                isLoadingInventory = false;\n                loadingPromise = null;\n            }\n        })();\n\n        return loadingPromise;\n    },\n\n    // Get inventory changes since timestamp\n    async getInventoryChanges(lastUpdate) {\n        if (DMI_CONFIG.USE_MOCK) {\n            return [];\n        }\n\n        try {\n            const url = buildUrl('inventorychanges', { lastupdate: lastUpdate });\n            const response = await apiClient.get(url);\n            return response.data;\n        } catch (error) {\n            console.error('Error fetching inventory changes:', error);\n            throw error;\n        }\n    },\n\n    // Optimized search with caching and indexing\n    async searchInventoryByModel(searchTerm) {\n        if (!searchTerm || searchTerm.length < 2) {\n            console.log('‚ùå Search term too short:', searchTerm);\n            return [];\n        }\n\n        console.log('üîç Starting search for:', searchTerm);\n\n        // Check search cache first\n        const cacheKey = searchTerm.toLowerCase();\n        const cachedResult = searchCache.get(cacheKey);\n        if (cachedResult && (Date.now() - cachedResult.timestamp < SEARCH_CACHE_DURATION)) {\n            console.log('üéØ Using cached search results for:', searchTerm);\n            return cachedResult.results;\n        }\n\n        try {\n            // Check if we have inventory data at all\n            if (!inventoryCache && !searchIndex) {\n                console.log('‚ö†Ô∏è No inventory data available, fetching...');\n                await this.getInventory();\n            }\n\n            // Use indexed search if available and fresh\n            if (searchIndex && indexTimestamp && (Date.now() - indexTimestamp < CACHE_DURATION)) {\n                console.log('‚ö° Using indexed search for:', searchTerm);\n                console.log('üìä Search index stats:', {\n                    modelEntries: searchIndex.byModel.size,\n                    brandEntries: searchIndex.byBrand.size,\n                    totalItems: searchIndex.allItems.length\n                });\n\n                const results = searchWithIndex(searchTerm, searchIndex);\n                console.log(`üì¶ Index search found ${results.length} results`);\n\n                // Sort results to prioritize exact matches\n                const searchLower = searchTerm.toLowerCase();\n                const sorted = results.sort((a, b) => {\n                    const aModelExact = a.Model_Number && a.Model_Number.toLowerCase() === searchLower;\n                    const bModelExact = b.Model_Number && b.Model_Number.toLowerCase() === searchLower;\n\n                    if (aModelExact && !bModelExact) return -1;\n                    if (!aModelExact && bModelExact) return 1;\n\n                    const aModelStarts = a.Model_Number && a.Model_Number.toLowerCase().startsWith(searchLower);\n                    const bModelStarts = b.Model_Number && b.Model_Number.toLowerCase().startsWith(searchLower);\n\n                    if (aModelStarts && !bModelStarts) return -1;\n                    if (!aModelStarts && bModelStarts) return 1;\n\n                    return 0;\n                });\n\n                const limitedResults = sorted.slice(0, 50);\n\n                // Cache the search results\n                searchCache.set(cacheKey, {\n                    results: limitedResults,\n                    timestamp: Date.now()\n                });\n\n                // Clean up old cache entries if too many\n                if (searchCache.size > MAX_SEARCH_CACHE_SIZE) {\n                    const oldestKey = searchCache.keys().next().value;\n                    searchCache.delete(oldestKey);\n                }\n\n                return limitedResults;\n            }\n\n            // Fallback to regular search if index not available\n            console.log('üîç Using regular search (no index) for:', searchTerm);\n            const inventory = await this.getInventory();\n            console.log(`üìä Inventory has ${inventory.length} items`);\n\n            if (inventory.length === 0) {\n                console.log('‚ùå No inventory data available');\n                return [];\n            }\n\n            const searchLower = searchTerm.toLowerCase();\n\n            // Filter results based on model number, description, or brand\n            const filtered = inventory.filter(item => {\n                const modelMatch = item.Model_Number && item.Model_Number.toLowerCase().includes(searchLower);\n                const descMatch = item.Description && item.Description.toLowerCase().includes(searchLower);\n                const brandMatch = item.Brand && item.Brand.toLowerCase().includes(searchLower);\n                const categoryMatch = item.Category_Major && item.Category_Major.toLowerCase().includes(searchLower);\n\n                return modelMatch || descMatch || brandMatch || categoryMatch;\n            });\n\n            console.log(`üì¶ Regular search found ${filtered.length} results`);\n\n            // Sort results to prioritize exact matches and model number matches\n            const sorted = filtered.sort((a, b) => {\n                const aModelExact = a.Model_Number && a.Model_Number.toLowerCase() === searchLower;\n                const bModelExact = b.Model_Number && b.Model_Number.toLowerCase() === searchLower;\n\n                if (aModelExact && !bModelExact) return -1;\n                if (!aModelExact && bModelExact) return 1;\n\n                const aModelStarts = a.Model_Number && a.Model_Number.toLowerCase().startsWith(searchLower);\n                const bModelStarts = b.Model_Number && b.Model_Number.toLowerCase().startsWith(searchLower);\n\n                if (aModelStarts && !bModelStarts) return -1;\n                if (!aModelStarts && bModelStarts) return 1;\n\n                return 0;\n            });\n\n            // Limit results for performance\n            const limitedResults = sorted.slice(0, 50);\n\n            // Cache the results\n            searchCache.set(cacheKey, {\n                results: limitedResults,\n                timestamp: Date.now()\n            });\n\n            return limitedResults;\n        } catch (error) {\n            console.error('Error searching inventory:', error);\n            // Return empty array on error\n            return [];\n        }\n    },\n\n    // Get inventory by brand\n    async getInventoryByBrand(brandCode) {\n        if (DMI_CONFIG.USE_MOCK) {\n            return [];\n        }\n\n        try {\n            const url = buildUrl('inventory', { brand: brandCode });\n            const response = await apiClient.get(url);\n            return response.data;\n        } catch (error) {\n            console.error('Error fetching inventory by brand:', error);\n            throw error;\n        }\n    },\n\n    // Get order status\n    async getOrderStatus(orderCriteria) {\n        if (DMI_CONFIG.USE_MOCK) {\n            return [];\n        }\n\n        try {\n            const url = buildUrl('orderstatus');\n            const response = await apiClient.post(url, orderCriteria);\n            return response.data;\n        } catch (error) {\n            console.error('Error fetching order status:', error);\n            throw error;\n        }\n    },\n\n    // Get open orders\n    async getOpenOrders(params = {}) {\n        if (DMI_CONFIG.USE_MOCK) {\n            return [];\n        }\n\n        try {\n            const url = buildUrl('openorders', params);\n            const response = await apiClient.get(url);\n            return response.data;\n        } catch (error) {\n            console.error('Error fetching open orders:', error);\n            throw error;\n        }\n    },\n\n    // Get open backorders\n    async getOpenBackorders(params = {}) {\n        if (DMI_CONFIG.USE_MOCK) {\n            return [];\n        }\n\n        try {\n            const url = buildUrl('openbackorders', params);\n            const response = await apiClient.get(url);\n            return response.data;\n        } catch (error) {\n            console.error('Error fetching open backorders:', error);\n            throw error;\n        }\n    },\n\n    // Get invoice details\n    async getInvoiceDetail(params = {}) {\n        if (DMI_CONFIG.USE_MOCK) {\n            return [];\n        }\n\n        try {\n            const url = buildUrl('invoicedetail', params);\n            const response = await apiClient.get(url);\n            return response.data;\n        } catch (error) {\n            console.error('Error fetching invoice detail:', error);\n            throw error;\n        }\n    },\n\n    // Create new order\n    async createNewOrder(orderData) {\n        if (DMI_CONFIG.USE_MOCK) {\n            return {\n                Result: 'OK',\n                Transaction_ID: 'MOCK_' + Date.now(),\n                DMI_Order_ID: Math.floor(Math.random() * 100000),\n                ...orderData[0].orderheader\n            };\n        }\n\n        try {\n            const url = buildPostUrl('neworder');\n            const response = await apiClient.post(url, orderData);\n            return response.data;\n        } catch (error) {\n            console.error('Error creating new order:', error);\n            throw error;\n        }\n    },\n\n    // Add new order line\n    async addNewOrderLine(orderLineData) {\n        if (DMI_CONFIG.USE_MOCK) {\n            return {\n                Result: 'OK',\n                Transaction_ID: 'MOCK_' + Date.now(),\n                ...orderLineData[0]\n            };\n        }\n\n        try {\n            const url = buildPostUrl('neworderline');\n            const response = await apiClient.post(url, orderLineData);\n            return response.data;\n        } catch (error) {\n            console.error('Error adding new order line:', error);\n            throw error;\n        }\n    },\n\n    // Change order\n    async changeOrder(changeData) {\n        if (DMI_CONFIG.USE_MOCK) {\n            return {\n                Result: 'OK',\n                Transaction_ID: 'MOCK_' + Date.now(),\n                ...changeData[0]\n            };\n        }\n\n        try {\n            const url = buildPostUrl('changeorder');\n            const response = await apiClient.post(url, changeData);\n            return response.data;\n        } catch (error) {\n            console.error('Error changing order:', error);\n            throw error;\n        }\n    },\n\n    // Change order item\n    async changeOrderItem(changeData) {\n        if (DMI_CONFIG.USE_MOCK) {\n            return {\n                Result: 'OK',\n                Transaction_ID: 'MOCK_' + Date.now(),\n                ...changeData[0]\n            };\n        }\n\n        try {\n            const url = buildPostUrl('changeorderitem');\n            const response = await apiClient.post(url, changeData);\n            return response.data;\n        } catch (error) {\n            console.error('Error changing order item:', error);\n            throw error;\n        }\n    },\n\n    // Utility function to format price\n    formatPrice(price) {\n        if (!price || price === '0.00') return 'Call for price';\n        return `$${parseFloat(price).toFixed(2)}`;\n    },\n\n    // Utility function to check availability\n    checkAvailability(item) {\n        const available = parseInt(item.Available) || 0;\n        const hasStock = item.Has_Stock === 'Y';\n        const backordered = parseInt(item.Backordered) || 0;\n        const onOrder = parseInt(item.On_Order) || 0;\n        const inTransit = parseInt(item.In_Transit) || 0;\n\n        if (hasStock && available > 0) {\n            return { status: 'In Stock', quantity: available, color: 'success' };\n        } else if (available > 0) {\n            return { status: 'Available', quantity: available, color: 'warning' };\n        } else if (inTransit > 0) {\n            return { status: 'In Transit', quantity: inTransit, color: 'info' };\n        } else if (onOrder > 0) {\n            return { status: 'On Order', quantity: onOrder, color: 'info' };\n        } else if (backordered > 0) {\n            return { status: 'Backordered', quantity: backordered, color: 'error' };\n        } else {\n            return { status: 'Out of Stock', quantity: 0, color: 'error' };\n        }\n    },\n\n    // Clear all caches\n    clearCache() {\n        inventoryCache = null;\n        cacheTimestamp = null;\n        searchCache.clear();\n        searchIndex = null;\n        indexTimestamp = null;\n        console.log('üßπ All caches cleared');\n    },\n\n    // Get cache status\n    getCacheStatus() {\n        return {\n            inventoryCached: !!inventoryCache,\n            inventoryCacheAge: cacheTimestamp ? Date.now() - cacheTimestamp : null,\n            searchCacheSize: searchCache.size,\n            indexAvailable: !!searchIndex,\n            indexAge: indexTimestamp ? Date.now() - indexTimestamp : null\n        };\n    },\n\n    // Get config for debugging\n    getConfig() {\n        return DMI_CONFIG;\n    },\n\n    // Export buildUrl for testing\n    buildUrl,\n\n    // Test API connectivity\n    async testConnection() {\n        console.log('üß™ Testing API connection...');\n        try {\n            // Try a simple request first\n            const testUrl = '/dealers/dmirest/dmirest.php?format=json&resource=inventory&dealerid=118215&restcode=DL67AJ19M2R0J&limit=1';\n            console.log('Test URL:', testUrl);\n\n            const response = await apiClient.get(testUrl, { timeout: 10000 }); // 10 second timeout for test\n            console.log('‚úÖ API connection successful!');\n            console.log('Response:', response.data);\n            return true;\n        } catch (error) {\n            console.error('‚ùå API connection failed:', error.message);\n            if (error.response) {\n                console.error('Response status:', error.response.status);\n                console.error('Response data:', error.response.data);\n            }\n            return false;\n        }\n    }\n};\n\nexport default dmiApi; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}